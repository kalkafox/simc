kind: pipeline
type: docker
name: simc

steps:
- name: submodules
  image: alpine/git
  commands:
  - git submodule update --init --recursive
- name: build
  image: archlinux:base-devel
  privileged: true
  commands:
  - pacman --noconfirm -Syyu curl pkg-config clang neofetch
  - neofetch
  - cd engine
  - make optimized CXX=clang
  - mkdir bin
  - mv simc bin
- name: publish
  image: plugins/github-release
  settings:
    api_key:
      from_secret: github_key
    files: engine/bin/*
  when:
    event: tag